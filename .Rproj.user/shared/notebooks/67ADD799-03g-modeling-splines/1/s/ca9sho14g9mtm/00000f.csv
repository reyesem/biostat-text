"0","#| label: fig-modeling-splines-rcs"
"0","#| echo: false"
"0","#| fig-cap: Illustration of a restricted cubic spline with five knot points."
"0","#| fig-alt: Curved line captured created by spline."
"0",""
"0","my_up <- function(x){"
"0","  x * (x > 0)"
"0","}"
"0",""
"0","my_rcs <- function(x, beta, knots) {"
"0","  out <- beta[1] * x"
"0","  k <- length(knots)"
"0","  "
"0","  for (j in 1:(k - 2)) {"
"0","    xj <- my_up(x - knots[j])^3 - "
"0","      ((my_up(x - knots[k-1])^3 * (knots[k] - knots[j])) / "
"0","         (knots[k] - knots[k-1])) +"
"0","      ((my_up(x - knots[k])^3 * (knots[k] - knots[j])) / "
"0","         (knots[k] - knots[k-1]))"
"0","    "
"0","    out <- out + beta[j+1] * xj"
"0","  }"
"0","  "
"0","  return(out)"
"0","}"
"0",""
"0","tibble("
"0","  x = seq(0, 10, length.out = 1000),"
"0","  y = 0 + my_rcs(x, c(1, -2, 8, -6), "
"0","                 knots = quantile(x, prob = c(0.05, 0.275, 0.5, 0.725, 0.95)))"
"0",") |>"
"0","  ggplot(mapping = aes(y = y, x = x)) +"
"0","  geom_line(linewidth = 1.1, color = ""blue"") +"
"0","  geom_vline(data = tibble(xintercept = c(0.5, 2.75, 5, 7.25, 9.5)),"
"0","             mapping = aes(xintercept = xintercept),"
"0","             color = ""red"", linetype = 2) +"
"0","  geom_label(data = tibble(x = c(0.5, 2.75, 5, 7.25, 9.5),"
"0","                           y = c(200, 200, 200, 200, 200),"
"0","                           label = c('t[1] == 0.5',"
"0","                                     't[2] == 2.75',"
"0","                                     't[3] == 5',"
"0","                                     't[4] == 7.25',"
"0","                                     't[5] == 9.5')),"
"0","             mapping = aes(y = y, x = x, label = label),"
"0","             color = ""red"","
"0","             parse = TRUE) +"
"0","  labs(y = ""Response"","
"0","       x = ""Predictor"")"
