{"title":"Nonlinear Models with Repeated Measures","markdown":{"headingText":"Nonlinear Models with Repeated Measures","headingAttr":{"id":"sec-nlm-rm","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n{{< include _setupcode.qmd >}}\n\nJust as the linear model could be extended to account for repeated measures, nonlinear models can be extended as well.  This is most commonly done through the mixed models framework (@sec-rm-mixed-models).  In this chapter we provide some guidance for extending the nonlinear modeling framework for those interested.  Readers may skip this chapter without loss of continuity.\n\nRecall the Theophylline example (@exm-nlm-theoph) we used to introduce nonlinear models at the beginning of this unit.  Researchers were interested in studying the pharmacokinetics of the anti-asthmatic agent.  In the original example, we considered blood samples taken from a single individual over a 24-hour period.  In reality, the study enrolled 12 subjects, and each had blood samples taken over a 24-hour period (@fig-nlm-rm-plot).\n\n```{r}\n#| label: fig-nlm-rm-plot\n#| fig-cap: Concentration of Theophylline in the blood stream of a several patients over a 24-hour period.\n#| fig-alt: Line plots illustrating clear curvature in the response over time.\n\nggplot(data = Theoph,\n       mapping = aes(y = conc, x = Time, group = Subject)) +\n  geom_line() +\n  labs(y = \"Concentration (mg/L)\",\n       x = \"Time (hrs)\")\n```\n\nThe goal of the study, and the goal of most pharmacokinetics studies, is to understand the way the body processes the drug _across the population_.  That is, researchers were interested in how the concentration-time profiles (through their parameters) varied across individuals.  Since we have multiple measurements for each of the 12 subjects, we have repeated measures data.\n\nNotice that the goal here is not to model the average trend in the population but to characterize the average (and even the variability) of in the parameters across individuals in the population.  This is not the same as a confidence interval for the parameter (which would still be describing the average value); researchers want to know how different the parameters can be across individuals.  This is the perfect set-up for a subject-specific modeling approach to the repeated measures.\n\nRecall that within a subject, researchers believe the one-compartment model with first-order absorption is an appropriate scientific model.  Therefore, our individual-level model has the form\n\n$$(\\text{Concentration})_{i,j} = \\frac{k_{a,i} D_i}{\\left(\\beta_i/k_{e,i}\\right)\\left(k_{a,i} - k_{e,i}\\right)} \\left(e^{-k_{e,i} t_{i,j}} - e^{-k_{a,i} t_{i,j}}\\right) + \\varepsilon_{i,j},$$\n\nwhere the parameters retain the same interpretations they had previously.  While the form is held the same across all subjects, the specific values of the parameters can vary from one subject to another.  The population-level model _could_ have the form\n\n$$\n\\begin{aligned}\n  k_{a,i} &= k_{a} + b_{1,i} \\\\\n  k_{e,i} &= k_{e} + b_{2,i} \\\\\n  \\beta_i &= \\beta + b_{3,i},\n\\end{aligned}\n$$\n\nwhere we assume each $b_{k,i} \\dist{IID} N\\left(0, \\sigma^2_k\\right)$ for each $k$ and assume all terms are independent.  That is, we are allowing each parameter to have a random effect that allows them to vary across the population.  The parameter $k_a$, for example, represents the average absorption rate across the population and $\\sigma_1^2$ would capture the variability of the absorption rate across the population.  \n\n```{r}\n#| label: nlm-rm-model\n\n# determine starting estimates\ninit.theoph <- nls(conc ~ SSfol(Dose, Time, lKe, lKa, lCl), data = Theoph)\n\n# fit nonlinear-mixed effects model\nmydata <- Theoph |>\n  as_tibble() |>\n  mutate(Subject = factor(Subject))\n\nfit2.theoph <- nlmer(conc ~ SSfol(Dose, Time, lKe, lKa, lCl) ~ \n                       (lKe + lKa + lCl)|Subject, \n                     data = mydata,\n                     start = coef(init.theoph))\n\nfit2.results <- tidy(fit2.theoph, effects = 'ran_pars')\n```\n\nFitting this model to the data illustrated in @fig-nlm-rm-plot, we estimate that the average clearance rate in the population is `r display_value(exp(fit2.theoph@beta[3]))`.  A confidence interval for the clearance rate is not of interest, as it would still be estimating the _average_ clearance rate in the population.  Based on the figure, the clearance rate differs across individuals; specifically, we estimate the clearance rate may vary between `r qnorm(0.025, mean = fit2.theoph@beta[3], sd = fit2.results$estimate[6]) |> exp() |> display_value()` and `r qnorm(0.925, mean = fit2.theoph@beta[3], sd = fit2.results$estimate[6]) |> exp() |> display_value()` among 95% of the population.\n\nWe could generalize the population-level model further to allow these parameters to depend upon other predictors (such as the weight of the subject).\n\nThese models are commonly fit (using specialized statistical software), but they continue to be the focus of research as there is not complete agreement on modeling constraints and how to relax conditions placed on the model.  Unlike the linear case, it is not easy to determine the overall average trend given the subject-level model (though it is theoretically feasible).  The nonlinearity makes several aspects of this problem quite challenging.\n\n\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"center","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["mystyles.css"],"output-file":"05g-nlm-rm.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["refs482notes.bib","packages.bib"],"comments":{"hypothesis":false},"fig-cap-location":"bottom","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":true,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"center","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"05g-nlm-rm.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["refs482notes.bib","packages.bib"],"comments":{"hypothesis":false},"fig-cap-location":"bottom","documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}